image:
  file: .gitpod.Dockerfile

ports:
  - port: 5173
    onOpen: open-preview
    visibility: public
  - port: 3030
    onOpen: ignore
    visibility: public

tasks:
  - name: bootstrap
    init: |
      # Install root deps if present
      [ -f package.json ] && (pnpm install || npm install) || true
      mkdir -p app
      echo '{"name":"app","private":true}' > app/package.json
    command: |
      # Start agent in background
      cd agent && (pnpm install || npm install) && pnpm dev &
      # Start app dev server in background (wait until files exist)
      cd ../app
      if [ -f package.json ]; then
        (pnpm install || npm install) && (pnpm dev || npm run dev) &
      else
        echo "Waiting for project generation..."
      fi
      wait
